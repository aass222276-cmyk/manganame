<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>manganame v3</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#ffffff">
  <style>
    :root{
      --ui: #222;
      --bg: #f0f0f3;
      --paper: #fff;
      --frame: #111;
      --gutter: #fff;
      --bubble: #000;
      --active: #2f7af3;
    }
    *{box-sizing:border-box; user-select:none;}
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Yu Gothic UI", "Yu Gothic", Meiryo, sans-serif;
      color:#111; overflow:hidden;
    }

    /* --- Toolbar --- */
    .bar{
      display:flex; align-items:center; gap:8px;
      padding:8px; background:#fff; border-bottom:1px solid #ddd;
      position:sticky; top:0; z-index:5;
      white-space:nowrap; overflow:auto; scrollbar-width:none;
    }
    .bar::-webkit-scrollbar{display:none;}
    button{
      height:30px; padding:0 10px; border:1px solid #ccc; background:#fff; border-radius:6px;
      font-size:14px; line-height:28px; cursor:pointer;
    }
    button:active{transform:translateY(1px);}
    .toggled{background:#e9f2ff; border-color:#83b6ff; color:#1852b8;}
    .ghost{opacity:.7}
    .pxview{min-width:42px; text-align:right; font-variant-numeric:tabular-nums;}

    .spacer{flex:1}

    /* --- Stage --- */
    .wrap{display:flex; height:calc(100% - 48px);}
    .stage{
      flex:1; overflow:auto; display:flex; justify-content:center; align-items:flex-start;
      padding:24px;
    }
    .page{
      position:relative; width:860px; height:1220px; /* B5縦相当 */
      background:var(--paper); border:6px solid transparent; box-shadow:0 1px 8px rgba(0,0,0,.08);
    }
    .page.active{ border-color:var(--active); }
    .paper-frame{
      position:absolute; inset:16px; border:3px solid var(--frame);
    }

    /* gutters are drawn on canvas export, but on editor we draw thin helper lines */
    .gline{ position:absolute; left:16px; right:16px; height:2px; background:var(--frame); }
    .gline.v{ width:2px; top:16px; bottom:16px; left:auto; background:var(--frame); }

    /* --- Bubble node --- */
    .bubble{
      position:absolute; min-width:24px; min-height:24px;
      padding:10px 12px; transform:translate(-50%, -50%);
      outline:1px dashed #bbb; border-radius:12px; background:transparent;
      display:flex; align-items:center; justify-content:center;
      cursor:text;
    }
    .bubble.selected{ outline:2px dashed #7aa7ff; }
    .bubble .shape{ position:absolute; inset:0; }
    .text{
      position:relative; white-space:pre; /* 折返し禁止：改行はEnterのみ */
      font-size:22px; line-height:1.4; color:#111; user-select:text; cursor:text;
      font-feature-settings:"palt" 1;
    }
    /* shape look (only editor) */
    .shape.ellipse{ border:3px solid var(--bubble); border-radius:999px; background:transparent; }
    .shape.rect{ border:3px solid var(--bubble); border-radius:0; background:transparent; }
    .shape.saw{ border:3px solid var(--bubble); border-radius:16px; background:transparent; clip-path:path("M0,18 L10,0 L20,18 L30,0 L40,18 L50,0 L60,18 L100%,18 L100%,calc(100% - 18) L90%,100% L80%,calc(100% - 18) L70%,100% L60%,calc(100% - 18) L0,calc(100% - 18) Z"); }

    /* small panel when selecting bubble */
    .selpanel{
      position:absolute; display:flex; gap:6px; padding:6px; background:#fff; border:1px solid #ddd; border-radius:8px;
      box-shadow:0 6px 16px rgba(0,0,0,.1);
      transform:translate(-50%,-110%); z-index:3;
    }
    .selpanel button{height:28px; font-size:12px; padding:0 8px;}
    .hidden{display:none;}

    /* multi pages strip */
    .pagestrip{
      position:fixed; bottom:10px; left:50%; transform:translateX(-50%);
      display:flex; gap:8px; z-index:6;
    }
    .thumb{
      width:64px; height:90px; background:#fff; border:2px solid #d6d6d6; cursor:pointer;
    }
    .thumb.active{ border-color:var(--active); }
  </style>

  <!-- libs for ZIP (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
  <div class="bar" id="toolbar">
    <button id="btnText" title="セリフ">セリフ</button>
    <button id="btnSplit" title="コマ枠">コマ枠</button>

    <div style="display:flex;align-items:center;gap:8px;margin-left:8px;">
      <span>文字サイズ</span>
      <input id="fontRange" type="range" min="12" max="40" value="22" />
      <span class="pxview" id="pxview">22px</span>
    </div>

    <div class="spacer"></div>

    <button id="btnAddPrev" title="前にページ追加">p↑</button>
    <button id="btnAddNext" title="後にページ追加">p↓</button>
    <button id="btnDelPage"  title="このページを削除">p×</button>

    <button id="btnCopy"  title="テキストコピー">テキストコピー</button>
    <button id="btnPaste" title="テキストペースト">テキストペースト</button>

    <button id="btnPng" title="PNG書き出し">PNG</button>
    <button id="btnZip" title="全ページPNG（ZIP）">ZIP</button>
  </div>

  <div class="wrap">
    <div class="stage">
      <div class="page active" id="page">
        <div class="paper-frame"></div>
        <!-- gutters (editor helper lines; actual export will draw real gutters) -->
        <div id="gContainer"></div>
      </div>
    </div>
  </div>

  <!-- page strip -->
  <div class="pagestrip" id="pagestrip"></div>

  <script src="app.js"></script>
</body>
</html>
