<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>NameBoard PWA</title>
  <meta name="theme-color" content="#111111">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    :root{
      --page-w:840px; --page-h:1400px;
      --pad:16px; --active:#007aff;
      --gutter-h:12px;  /* 横線の白溝(広い) 初期 */
      --gutter-v:6px;   /* 縦線の白溝(狭い) 初期  */
      --stroke-b:2px;   /* 黒線太さ */
      font-family:system-ui,-apple-system,'Hiragino Sans','Noto Sans JP',sans-serif;
    }
    *{ touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    body{ margin:0; background:#f2f2f2; }
    header{ position:sticky; top:0; z-index:20; background:#fff; border-bottom:1px solid #ddd; padding:.5rem; display:flex; gap:.5rem; align-items:center; overflow:auto; }
    header button, header select, header input[type="range"]{
      font-size:14px; padding:.45rem .7rem; border:1px solid #ccc; border-radius:8px; background:#fff;
    }
    header .mode-on{ background:#e6f0ff; border-color: var(--active); }
    header .hidden{ display:none; }
    #pages{ padding:12px; display:flex; flex-direction:column; align-items:center; gap:16px; }
    .page-wrap{ position:relative; }
    .page{
      position:relative; background:#fff; width:var(--page-w); height:var(--page-h);
      box-shadow:0 2px 8px rgba(0,0,0,.12); overflow:hidden; border:2px solid transparent;
    }
    .page.current{ border-color: var(--active); }
    .panel-layer, .line-layer{ position:absolute; inset:0; pointer-events:none; }
    .panel-layer svg, .line-layer svg{ width:100%; height:100%; display:block; }
    .panel-preview{ pointer-events:none; position:absolute; inset:0; }
    .panel-preview line{ stroke:#4da3ff; stroke-width:2; vector-effect:non-scaling-stroke; stroke-dasharray:6 6; }

    .textbox{ position:absolute; min-width:40px; min-height:40px; box-sizing:border-box; padding:var(--pad); border:1px dashed #888; border-radius:6px; background:transparent; }
    .textbox .balloon{ position:absolute; inset:0; z-index:0; pointer-events:none; }
    .textbox .content{ position:relative; z-index:1; outline:none; white-space:pre-wrap; }
    .vh{ writing-mode:vertical-rl; text-orientation:upright; line-height:1.6; }
    .hh{ writing-mode:horizontal-tb; line-height:1.6; }
    .selected{ outline:2px solid var(--active); outline-offset:0; }

    @media (max-width: 920px){
      :root{ --page-w: calc(100vw - 24px); --page-h: calc((100vw - 24px) * 1.6); }
    }
    @media print{
      @page{ size:A4; margin:10mm; }
      header{ display:none; }
      body{ background:#fff; }
      .page{ box-shadow:none; page-break-after:always; width:190mm; height:277mm; }
    }
    .spacer{ flex:1; }
  </style>
</head>
<body>
  <header>
    <!-- 通常/選択モード -->
    <button id="modePointer" title="通常モード">通常</button>

    <!-- ページ操作 -->
    <button id="addPageBefore" title="上にページ追加">↑P</button>
    <button id="addPageAfter"  title="下にページ追加">↓P</button>
    <button id="delPage"       title="このページを削除">削P</button>

    <!-- 文字追加モード（タップでセリフ） -->
    <button id="modeText" title="文字追加（タップで配置）">文字</button>

    <!-- コマ分割モード（タップ＆ドラッグで分割線） -->
    <button id="modePanel" title="コマ枠追加（タップ→ドラッグ→離すで確定）">コマ</button>

    <!-- 文字サイズ：段階スナップ -->
    <label>文字
      <input id="fontSnap" type="range" min="0" max="9" step="1" value="4" style="width:140px">
    </label>

    <!-- 吹き出し形状：選択時のみ有効 -->
    <span id="bubbleGroup" class="hidden">
      <button data-bubble="round" class="bubbleBtn">○</button>
      <button data-bubble="rect"  class="bubbleBtn">□</button>
      <button data-bubble="jagged" class="bubbleBtn">≡</button>
    </span>

    <span class="spacer"></span>

    <!-- テキスト入出力・PDF -->
    <button id="exportText" title="テキストコピー">テキストコピー</button>
    <button id="importText" title="テキストペースト">テキストペースト</button>
    <button id="exportPNG"  title="PNG書き出し（低画質OK）">PNG</button>
    <!-- 可能ならPDF。iOS Safari制約があるためPNG→共有でPDF想定 -->
  </header>

  <div id="pages"></div>

  <script type="module" src="app.js"></script>
  <script>
    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
